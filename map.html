<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Help Around Me</title>
  <style>
    body, html {
      height: 100%;
      margin: 0;
      padding: 0;
    }
    #map {
      height: 100%;
      width: 100%;
    }
  </style>
</head>
<body>
  <div id="map"></div>

  <script>
    let map;

    function initMap() {
      const defaultLocation = { lat: 28.6139, lng: 77.2090 }; // Delhi fallback
      map = new google.maps.Map(document.getElementById("map"), {
        zoom: 12,
        center: defaultLocation,
      });

      // 1. Get current user location
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
          (position) => {
            const userLocation = {
              lat: position.coords.latitude,
              lng: position.coords.longitude
            };

            // Show user location marker
            new google.maps.Marker({
              position: userLocation,
              map,
              title: "You are here",
              icon: {
                url: "http://maps.google.com/mapfiles/ms/icons/blue-dot.png"
              }
            });

            const userInfo = new google.maps.InfoWindow({
              content: "<strong>You are here</strong>"
            });

            userInfo.open(map);
            map.setCenter(userLocation);
          },
          () => {
            alert("Location access denied or unavailable. Showing default location.");
          }
        );
      } else {
        alert("Geolocation is not supported by this browser.");
      }

      // 2. Load househelps from localStorage
      const househelps = JSON.parse(localStorage.getItem("househelps")) || [];

      househelps.forEach(helper => {
        if (!helper.location) return;

        const geocoder = new google.maps.Geocoder();

        geocoder.geocode({ address: helper.location }, (results, status) => {
          if (status === "OK" && results[0]) {
            const position = results[0].geometry.location;

            const marker = new google.maps.Marker({
              position,
              map,
              title: helper.name,
            });

            const infoWindow = new google.maps.InfoWindow({
              content: `
                <div>
                  <strong>${helper.name}</strong><br>
                  <em>${helper.skills}</em><br>
                  üìç ${helper.location}
                </div>
              `
            });

            marker.addListener("click", () => {
              infoWindow.open(map, marker);
            });
          }
        });
      });
    }
  </script>

  <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDV2j_TeDEpmOTzjfvuEEl3RroQ2lr7p-I&callback=initMap">
  </script>
</body>
</html>